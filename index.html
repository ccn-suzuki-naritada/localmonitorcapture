<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Screen Share + Multi MP3 Player</title>
  <style>
    body { font-family: sans-serif; }
    video { width: 100%; border: 1px solid #ccc; margin-top: 10px; }
    .player { border: 1px solid #ccc; padding: 10px; margin: 10px 0; width: 420px; }
    button { margin: 2px; }
    input[type="range"] { width: 300px; }
    .time { font-size: 0.9em; }
  </style>
</head>
<body>
  <h2>画面共有</h2>
  <button id="start">画面を共有</button>
  <br>
  <video id="screen" autoplay playsinline></video>

  <h2>MP3 プレイヤー</h2>

  <div id="players"></div>

  <script>
    // 画面共有
    document.getElementById("start").onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        document.getElementById("screen").srcObject = stream;
      } catch (err) {
        console.error("画面共有エラー:", err);
      }
    };

    // プレイヤー生成関数
    function createPlayer(container, fileName, title) {
      const wrapper = document.createElement("div");
      wrapper.className = "player";

      const heading = document.createElement("h3");
      heading.textContent = title;
      wrapper.appendChild(heading);

      const audio = new Audio(fileName);

      const playBtn = document.createElement("button");
      playBtn.textContent = "▶ 再生";
      playBtn.onclick = () => audio.play();

      const pauseBtn = document.createElement("button");
      pauseBtn.textContent = "⏸ 一時停止";
      pauseBtn.onclick = () => audio.pause();

      const replayBtn = document.createElement("button");
      replayBtn.textContent = "⏮ リプレイ";
      replayBtn.onclick = () => { audio.currentTime = 0; audio.play(); };

      const loopBtn = document.createElement("button");
      loopBtn.textContent = "🔁 ループOFF";
      loopBtn.onclick = () => {
        audio.loop = !audio.loop;
        loopBtn.textContent = audio.loop ? "🔁 ループON" : "🔁 ループOFF";
      };

      const seek = document.createElement("input");
      seek.type = "range";
      seek.min = 0;
      seek.max = 100;
      seek.value = 0;

      const timeLabel = document.createElement("span");
      timeLabel.className = "time";
      timeLabel.textContent = "0:00 / 0:00";

      const volumeLabel = document.createElement("label");
      volumeLabel.textContent = " 音量:";
      const volume = document.createElement("input");
      volume.type = "range";
      volume.min = 0;
      volume.max = 1;
      volume.step = 0.01;
      volume.value = 1;
      volume.oninput = () => { audio.volume = volume.value; };

      // シーク更新
      audio.addEventListener("timeupdate", () => {
        if (!isNaN(audio.duration)) {
          seek.value = (audio.currentTime / audio.duration) * 100;
          timeLabel.textContent = formatTime(audio.currentTime) + " / " + formatTime(audio.duration);
        }
      });

      // シーク操作
      seek.addEventListener("input", () => {
        if (!isNaN(audio.duration)) {
          audio.currentTime = (seek.value / 100) * audio.duration;
        }
      });

      wrapper.appendChild(playBtn);
      wrapper.appendChild(pauseBtn);
      wrapper.appendChild(replayBtn);
      wrapper.appendChild(loopBtn);
      wrapper.appendChild(document.createElement("br"));
      wrapper.appendChild(seek);
      wrapper.appendChild(timeLabel);
      wrapper.appendChild(document.createElement("br"));
      wrapper.appendChild(volumeLabel);
      wrapper.appendChild(volume);

      container.appendChild(wrapper);
    }

    // 時間表示用フォーマット
    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return `${m}:${s.toString().padStart(2, "0")}`;
    }

    // プレイヤーを追加
    const playersContainer = document.getElementById("players");
    createPlayer(playersContainer, "bgm.mp3", "🎵 bgm 1");
    createPlayer(playersContainer, "doragon.mp3", "🎵 ドラゴン 2");
  </script>
</body>
</html>
